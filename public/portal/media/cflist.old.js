"use strict";function CFileList(parent){var self=this;VList.call(this,{size:5}),this.parent=parent,this.name="CFileList",this.bcrumb=null,this.sbar=null,this.ext2type={},this.LEVEL_CHANGE_NONE=0,this.LEVEL_CHANGE_UP=-1,this.LEVEL_CHANGE_DOWN=1,this.path=[],this.subList=[],this.playList=[],this.playListSet=!1,this.mtypes=[],this.hideF2=!0,this.canFav=!0,this.total=0,MEDIA_EXTENSION[MEDIA_TYPE_VIDEO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_VIDEO}),MEDIA_EXTENSION[MEDIA_TYPE_AUDIO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_AUDIO}),MEDIA_EXTENSION[MEDIA_TYPE_IMAGE].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_IMAGE}),MEDIA_EXTENSION[MEDIA_TYPE_TEXT].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_TEXT}),MEDIA_EXTENSION[MEDIA_TYPE_ISO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_ISO}),MEDIA_EXTENSION[MEDIA_TYPE_PLAYLIST].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_PLAYLIST}),MEDIA_EXTENSION[MEDIA_TYPE_CUE].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_CUE}),MEDIA_EXTENSION[MEDIA_TYPE_RECORDS_ITEM].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_RECORDS_ITEM})}CFileList.prototype=Object.create(VList.prototype),CFileList.prototype.constructor=CFileList,CFileList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},CFileList.prototype.SetSearchBar=function(component){this.sbar=component},CFileList.prototype.Open=function(data,level){echo(data.type,"CFileList.Open"),this.fileBrowser.open(data,level)},CFileList.prototype.SetFilterText=function(text){this.filterText=text,this.fileBrowser.filterText(this.filterText)},CFileList.prototype.SetFilterType=function(type){this.filterType=type,this.fileBrowser.filterType(this.filterType)},CFileList.prototype.GetPlaylist=function(){var self=this,list=[];return this.data.filter(function(item){return item.data?item.data.marked:!1}).forEach(function(item){-1!==self.parent.playable.indexOf(item.data.type)&&list.push(item.data)}),list},CFileList.prototype.Clear=function(){this.sbar&&this.sbar.Reset(),this.filterText="",this.filterType=MEDIA_TYPE_NONE,this.mtypes=[],this.subList=[],this.playList=[],this.playListSet=!1},CFileList.prototype.Reposition=function(data,manageFocus){var i,viewIndex;return data?(i=data.index||0,i<this.size?viewIndex=0:i>this.data.length-this.size?(viewIndex=this.data.length-this.size,i-=viewIndex):(viewIndex=data.index-Math.round(this.size/2.5),i-=viewIndex),this.indexView=-1,this.renderView(viewIndex),manageFocus&&this.focusItem(this.$body.children[i]),this.parent.Preview.isVisible&&this.parent.Preview.Info(this.activeItem.data),!0):!1},CFileList.prototype.focusItem=function(item){var self=this,$prev=this.activeItem;return void 0!==item&&$prev!==item&&item.data?(null!==$prev&&$prev.classList.remove("focused"),this.activeItem=item,this.activeItem.data=this.data[this.activeItem.index],item.classList.add("focused"),this.timer&&clearTimeout(this.timer),self.parent.Preview.isVisible&&self.parent.isVisible&&(MediaPlayer.end(),this.timer=setTimeout(function(){self.parent.Preview.Info(item.data)},400)),!0):!1},CFileList.prototype.onLevelChange=function(context,data,level){this.data=data,this.filterText=context.filterText?context.filterText:"",level===this.LEVEL_CHANGE_DOWN?(this.indexView=-1,this.renderView(0),this.focusItem(this.$body.firstChild),this.filterText?this.bcrumb&&this.bcrumb.Push("/","media/ico_filter.png",this.filterText):this.bcrumb&&(context.type===MEDIA_TYPE_ROOT_MB?(this.bcrumb.Reset(),this.bcrumb.Push("/","media/type_"+MEDIA_TYPE_ROOT_MB+".png",context.name?context.name:"")):this.bcrumb.Push("/","media/type_"+context.type+".png",context.name?context.name:"")),this.path.push(context),this.Activate(!0)):this.Reposition(this.parentItem,!0)||this.Activate(!0),this.parent.Tray.iconFilter.parentNode===this.parent.Tray.handleInner&&this.parent.Tray.handleInner.removeChild(this.parent.Tray.iconFilter),this.parent.Tray.Show(globalBuffer.size()>0,!1),this.mode=void 0!==this.path[1]?this.path[1].type:MEDIA_TYPE_ROOT_MB,this.parentItem=this.path[this.path.length-1],this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0),this.parent.Preview.SetItemsCount()},CFileList.prototype.ActiveItems=function(){var items=this.data.filter(function(item){return item.marked});return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem.data),items},CFileList.prototype.SetStar=function(item,state){var indexView=this.indexView,result=this.SetState(item,"stared",state);return result?(this.activeItem.data===item?state?(this.activeItem.classList.add("stared"),this.activeItem.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav.png") no-repeat right'):(this.activeItem.classList.remove("stared"),this.activeItem.star.style.background="none"):(this.indexView=-1,this.renderView(indexView)),result):!1},CFileList.prototype.Marked=function(item,state){var result,indexView=this.indexView;return item&&item.markable&&(result=this.SetState(item,"marked",state))?(item===this.activeItem.data?state?this.activeItem.classList.add("marked"):this.activeItem.classList.remove("marked"):(this.indexView=-1,this.renderView(indexView)),result):!1},CFileList.prototype.FirstMatch=function(value){var item,i,len=this.data.length;for(i=0;len>i;i++)if(item=this.data[i],item.type!==MEDIA_TYPE_BACK&&item.name&&-1!==item.name.toLowerCase().indexOf(value.toLowerCase()))return i},CFileList.prototype.Focused=function(index,focus){this.Reposition(this.data[index],focus)},CFileList.prototype.renderItem=function($item,attrs){$item.ready?($item.$body.innerText=attrs.name,$item.$body.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat left'):($item.innerHTML="",$item.$body=element("div",{className:"data"},attrs.name),$item.star=element("div",{className:"star"}),$item.$body.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat left',$item.appendChild($item.star),$item.appendChild($item.$body),$item.ready=!0)},CFileList.prototype.renderView=function(index){var $item,i,itemData,prevIndex;if(echo(index,"renderView"),!(this.data.length>this.size&&index>this.data.length-this.size)){if(this.indexView!==index){for(prevIndex=this.indexView,this.indexView=index,i=0;i<this.size;i++)$item=this.$body.children[i],itemData=this.data[index],itemData?(itemData.index=index,$item.data=itemData,$item.index=index,this.renderItem($item,itemData),itemData.marked?$item.classList.add("marked"):$item.classList.remove("marked"),itemData.stared?($item.classList.add("stared"),$item.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav.png") no-repeat right'):($item.classList.remove("stared"),$item.star.style.background="none")):($item.data=$item.index=void 0,$item.ready&&($item.$body.innerText="",$item.$body.style.background="",$item.star.style.background="none",$item.classList.remove("marked"))),index++;return echo(this.total,"this.total"),this.scrollBar.realSize!==this.total&&this.scrollBar.init({realSize:this.total}),this.scroller[this.mode](),this.scrollBar.scrollTo(this.indexView),this.fileBrowser.onRenderView&&this.fileBrowser.onRenderView(this.indexView,this.indexView>prevIndex),!0}return!1}},CFileList.prototype.onFocus=function(item){var self=this;item&&(this.states.marked&&0!==this.states.marked.length||(this.mode!==MEDIA_TYPE_FAVORITES?self.canFav&&item.data.type!==MEDIA_TYPE_FOLDER&&item.data.type!==MEDIA_TYPE_BACK?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.data.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.data.stared)):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)):this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,item.data.type===MEDIA_TYPE_BACK)),item.data.markable?this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,item.data.type===MEDIA_TYPE_BACK):this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.timer&&clearTimeout(this.timer),self.parent.Preview.isVisible&&self.parent.isVisible&&(MediaPlayer.end(),this.timer=setTimeout(function(){self.parent.Preview.Info(item.data)},400)))},CFileList.prototype.Init=function(config){var self=this;config.onClick=function(){void 0!==this.data&&(self.focusItem(this),self.fileBrowser.open(this.data))},VList.prototype.Init.call(this,config),""!==environment.upnp_conf&&"off"!==environment.upnp_conf&&window.stbUPnP&&window.stbUPnP.getServerListSync&&UPnPBrowser.init(this)},CFileList.prototype.onOverflow=function(event){this.fileBrowser.onOverflow&&this.fileBrowser.onOverflow(event)},CFileList.prototype.Refresh=function(refocus){var data=null;null!==this.parentItem&&(refocus!==!1&&this.activeItem&&(data=this.activeItem.data),this.fileBrowser.open(this.parentItem),this.Reposition(data,!0))};