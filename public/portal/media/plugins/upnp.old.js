"use strict";!function(){function openError(data){echo(data,"openError"),new CModalAlert(listLink.parent,_("Error"),_("Unknown type of selected item"),_("Close"))}function prepareContent(list){for(var item,result=[];item=list.shift();){switch(item.ContentType){case stbUPnP.TYPE_FOLDER:item.type=MEDIA_TYPE_UPNP_FOLDER,item.url=item.ID;break;case stbUPnP.TYPE_AUDIO:item.type=MEDIA_TYPE_AUDIO;break;case stbUPnP.TYPE_VIDEO:item.type=MEDIA_TYPE_VIDEO;break;case stbUPnP.TYPE_IMAGE:item.type=MEDIA_TYPE_IMAGE;break;default:item.type=MEDIA_TYPE_TEXT}item.markable=!1,item.type!==stbUPnP.TYPE_FOLDER&&item.Resources&&item.Resources.length&&(item.url=item.Resources[0].Value,item.size=item.Resources[0].Size),item.Resources=null,item.readOnly=!0,item.name=item.Title,-1!==listLink.parent.playable.indexOf(item.type)&&listLink.playList.push(item),result.push(item),++itr}return listLink.mtypes.push(MEDIA_TYPE_UPNP_FOLDER),echo(result.length,"prepareContent"),result}function onOpenContext(data,error){var content=[];return error?(echo(error,"onOpenContext.error"),loadingHint.Show(!1),new CModalHint(listLink.parent,_("Unable to connect to the resource<br>with the given parameters"),4e3),void openBack()):(echo(data,"onOpenContext"),prevPage=0,content.push({type:MEDIA_TYPE_BACK,name:".."}),listLink.total=stbUPnP.pagesCount*stbUPnP.pageSize,data&&Array.isArray(data)&&content.length>0&&(content=content.concat(prepareContent(data)),topEl=content.length>stbUPnP.pageSize?content.pop():!1),loadingHint.Show(!1),void listLink.onLevelChange(context,content,levelChange))}function onOpenPage(data,error){var page=stbUPnP.pageNumber;return error?(echo(error,"onOpenPage.error"),void loadingHint.Show(!1)):(echo(page,"onOpenPage"),void(0===page?(data=prepareContent(data),data.unshift({type:MEDIA_TYPE_BACK,name:".."}),topEl=data.length>stbUPnP.pageSize?data.pop():!1,listLink.data=data,prevPage>page?(listLink.indexView=data.length,listLink.renderView(data.length-listLink.size),listLink.focusItem(listLink.$body.lastChild)):(listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)),listLink.total=stbUPnP.pagesCount*stbUPnP.pageSize):data&&Array.isArray(data)&&data.length>0&&(data=prepareContent(data),prevPage>page?(listLink.data=data,listLink.indexView=data.length,listLink.renderView(data.length-listLink.size),listLink.focusItem(listLink.$body.lastChild)):stbUPnP.pagesCount-1===page?(echo(topEl,"DADAADADAD"),topEl&&data.push(topEl),listLink.data=data,listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)):(listLink.data=data,listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)),prevPage=page)))}function openUPnPRoot(data,level){var servers=stbUPnP.getServerListSync(),content=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),servers&&Array.isArray(servers)&&servers.length>0?(servers.forEach(function(server){content.push({markable:!1,readOnly:!0,name:server.FriendlyName,url:server.UDN,type:MEDIA_TYPE_UPNP_HOST})}),inServer=!1,levelChange=level,listLink.total=content.length,listLink.onLevelChange(context,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get dlna group servers")+(servers.errMsg?":<br>"+servers.errMsg:"."),_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openUPnPHost(data,level){inServer=!0,loadingHint?(loadingHint.Free(),loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0)):loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0),levelChange=level,stbUPnP.openServer(data.url)}function openUPnPFolder(data,level){loadingHint?(loadingHint.Free(),loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0)):loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0),listLink.path[listLink.path.length-1].pId=data.ID,levelChange=level,level===listLink.LEVEL_CHANGE_UP?(echo(data.pId,"data.pId"),stbUPnP.openContext(data.pId)):stbUPnP.openContext(data.ID)}function openBack(){listLink.path.pop(),listLink.bcrumb&&listLink.bcrumb.Pop(),stbUPnP.setFilterName(listLink.path[listLink.path.length-1].filterText?listLink.path[listLink.path.length-1].filterText:""),stbUPnP.setFilterType(MEDIA_TYPE_NONE),UPnPBrowser.open(listLink.path[listLink.path.length-1],listLink.LEVEL_CHANGE_UP)}function openFile(data){listLink.timer&&clearTimeout(listLink.timer),listLink.playListSet||(MediaPlayer.prepareList(listLink.playList),MediaPlayer.setSubList(listLink.subList),listLink.playListSet=!0),MediaPlayer.playNow||null!==MediaPlayer.obj?(MediaPlayer.Show(!0,listLink.parent),setTimeout(function(){MediaPlayer.changeScreenMode(!0)},0)):MediaPlayer.preparePlayer(data,listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1)}function route(data,level){level=level||listLink.LEVEL_CHANGE_DOWN,context=data,listLink.Clear(),data&&routes[data.type]?(listLink.fileBrowser=UPnPBrowser,routes[data.type](data,level)):openError(data,level)}function onRenderView(){listLink.scrollBar.scrollTo(stbUPnP.pageNumber*stbUPnP.pageSize)}function onOverflow(event){inServer&&1!==stbUPnP.pagesCount&&(event.direction!==KEYS.DOWN||stbUPnP.pagesCount!==stbUPnP.pageNumber-1)&&(event.direction!==KEYS.UP||0!==stbUPnP.pageNumber)&&(event.direction===KEYS.DOWN?(pageDirection=!0,stbUPnP.openPage(stbUPnP.pageNumber+1)):event.direction===KEYS.UP&&(pageDirection=!1,stbUPnP.openPage(stbUPnP.pageNumber-1)))}var topEl,loadingHint,listLink,levelChange,pageDirection,context,routes={},inServer=!1,prevPage=0,itr=0;window.UPnPBrowser={init:function(list){listLink=list,stbUPnP.init(),stbUPnP.onOpenContext=onOpenContext,stbUPnP.onOpenServer=onOpenContext,stbUPnP.onOpenPage=onOpenPage,stbUPnP.pageSize=list.size,routes[MEDIA_TYPE_UPNP_ROOT]=openUPnPRoot,routes[MEDIA_TYPE_UPNP_HOST]=openUPnPHost,routes[MEDIA_TYPE_UPNP_FOLDER]=openUPnPFolder,routes[MEDIA_TYPE_BACK]=openBack,routes[MEDIA_TYPE_RECORDS_ITEM]=openFile,routes[MEDIA_TYPE_VIDEO]=openFile,routes[MEDIA_TYPE_AUDIO]=openFile,routes[MEDIA_TYPE_IMAGE]=openFile,routes[MEDIA_TYPE_ISO]=openFile,routes[MEDIA_TYPE_STREAM]=openFile,routes[MEDIA_TYPE_DVB]=openFile,routes[MEDIA_TYPE_CUE_ITEM]=openFile,routes[MEDIA_TYPE_ROOT_MB]=function(data,level){FileBrowser&&FileBrowser.open(data,level)},window.UPnPBrowser={open:route,filterText:function(text){stbUPnP.setFilterName(text),prevPage=-1,stbUPnP.openPage(0)},filterType:function(type){stbUPnP.setFilterType(type),prevPage=-1,stbUPnP.openPage(0)},onRenderView:onRenderView,onOverflow:onOverflow}}}}();